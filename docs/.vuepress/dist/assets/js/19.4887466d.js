(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{184:function(e,n,t){"use strict";t.r(n);var s=t(0),a=Object(s.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{staticClass:"content"},[t("h1",{attrs:{id:"go"}},[e._v("Go")]),e._v(" "),t("p",[e._v("KubeMQ is an enterprise grade message broker for containers, designed for any type of workload and architecture running in Kubernetes.\nThis library is Go implementation of KubeMQ client connection.")]),e._v(" "),t("h3",{attrs:{id:"installation"}},[e._v("Installation")]),e._v(" "),t("p",[t("code",[e._v("$ go get -u github.com/kubemq-io/kubemq-go")])]),e._v(" "),t("h3",{attrs:{id:"examples"}},[e._v("Examples")]),e._v(" "),t("p",[e._v("Please find usage examples on the examples folders.")]),e._v(" "),t("h3",{attrs:{id:"kubemq-server"}},[e._v("KubeMQ server")]),e._v(" "),t("p",[e._v("Please visit https://kubemq.io, create an account, get KubeMQ token and follow the instructions to run the KubeMQ docker container in your environment.")]),e._v(" "),t("h2",{attrs:{id:"core-concepts"}},[e._v("Core Concepts")]),e._v(" "),t("p",[e._v("KubeMQ messaging broker has 4 messaging patterns:")]),e._v(" "),t("ul",[t("li",[e._v("Events - real time pub/sub pattern")]),e._v(" "),t("li",[e._v("Events Store - pub/sub with persistence pattern")]),e._v(" "),t("li",[e._v("Commands - the Command part of CQRS pattern, which send a commands with response for executed or not (with proper error messaging)")]),e._v(" "),t("li",[e._v("Queries - the Query part of CQRS pattern, which send a query and get response with the relevant query result back")])]),e._v(" "),t("p",[e._v("For each one of the patterns we can distinguish between the senders and the receivers.")]),e._v(" "),t("p",[e._v("For events and events store the KubeMQ supports both rpc and upstream calls.")]),e._v(" "),t("p",[e._v("the data model is almost identical between all the pattern with some data added related to the specific patter.")]),e._v(" "),t("p",[e._v("The common part of all the patters are:")]),e._v(" "),t("ul",[t("li",[e._v("Id - the sender can set the Id for each type of message, or the Id will be generate UUID Id for him.")]),e._v(" "),t("li",[e._v("Metadata - a string field that can hold any metadata related to the message")]),e._v(" "),t("li",[e._v("Body - a Bytes array which hold the actual payload to be send from the sender to the receiver")])]),e._v(" "),t("p",[e._v("The KubeMQ core transport is based on gRPC and the library is a wrapper around the client side of gRPC complied protobuf hence leveraging the gRPC benefits and advantages.")]),e._v(" "),t("p",[e._v("Before any transactions to be perform with KubeMQ server the Client should connect and dial KubeMQ server and obtain Client connection.")]),e._v(" "),t("p",[e._v("With the Client connection object the user can perform all transactions to and from KubeMQ server.")]),e._v(" "),t("p",[e._v("A Client connection object is thread safe and can be shared between all process needed to communicate with KubeMQ.")]),e._v(" "),t("p",[t("strong",[e._v("IMPORTANT")]),e._v(" - it's the user responsibility to close the Client connection when no further communication with KubeMQ is needed.")]),e._v(" "),t("h2",{attrs:{id:"connection"}},[e._v("Connection")]),e._v(" "),t("p",[e._v("Connecting to KubeMQ server can be done like that:")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('ctx, cancel := context.WithCancel(context.Background())\ndefer cancel()\nclient, err := kubemq.NewClient(ctx,\nkubemq.WithAddress("localhost", 50000),\nkubemq.WithClientId("test-event-client-id"))\nif err != nil {\n\tlog.Fatal(err)\n}\ndefer client.Close()\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br")])]),t("p",[e._v("List of connection options:")]),e._v(" "),t("ul",[t("li",[e._v("WithAddress - set host and port address of KubeMQ server")]),e._v(" "),t("li",[e._v("WithCredentials - set secured TLS credentials from the input certificate file for client.")]),e._v(" "),t("li",[e._v("WithToken - set KubeMQ token to be used for KubeMQ connection - not mandatory, only if enforced by the KubeMQ server")]),e._v(" "),t("li",[e._v("WithClientId - set client id to be used in all functions call with this client - mandatory")]),e._v(" "),t("li",[e._v("WithReceiveBufferSize - set length of buffered channel to be set in all subscriptions")]),e._v(" "),t("li",[e._v("WithDefaultChannel - set default channel for any outbound requests")]),e._v(" "),t("li",[e._v("WithDefaultCacheTTL - set default cache time to live for any query requests with any CacheKey set value")]),e._v(" "),t("li",[e._v("WithTransportType - set client transport type, currently gRPC or Rest")])]),e._v(" "),t("h2",{attrs:{id:"events"}},[e._v("Events")]),e._v(" "),t("h3",{attrs:{id:"sending-events"}},[e._v("Sending Events")]),e._v(" "),t("h4",{attrs:{id:"single-event"}},[e._v("Single Event")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('err := client.E().\n\t\tSetId("some-id").\n\t\tSetChannel(channel).\n\t\tSetMetadata("some-metadata").\n\t\tSetBody([]byte("hello kubemq - sending single event")).\n\t\tSend(ctx)\nif err != nil {\n\tlog.Fatal(err)\n}\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br")])]),t("h4",{attrs:{id:"stream-events"}},[e._v("Stream Events")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('eventStreamCh := make(chan *kubemq.Event, 1)\nerrStreamCh := make(chan error, 1)\ngo client.StreamEvents(ctx, eventStreamCh, errStreamCh)\nevent := client.E().SetId("some-event-id").\n\tSetChannel("some_channel").\n\tSetMetadata("some-metadata").\n\tSetBody([]byte("hello kubemq - sending stream event"))\nfor {\n\tselect {\n\tcase err := <-errStreamCh:\n\t\tlog.Println(err)\n\t\treturn\n\tcase eventStreamCh <- event:\n\t\treturn\n\t}\n}\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br"),t("span",{staticClass:"line-number"},[e._v("11")]),t("br"),t("span",{staticClass:"line-number"},[e._v("12")]),t("br"),t("span",{staticClass:"line-number"},[e._v("13")]),t("br"),t("span",{staticClass:"line-number"},[e._v("14")]),t("br"),t("span",{staticClass:"line-number"},[e._v("15")]),t("br"),t("span",{staticClass:"line-number"},[e._v("16")]),t("br")])]),t("h3",{attrs:{id:"receiving-events"}},[e._v("Receiving Events")]),e._v(" "),t("p",[e._v("First you should subscribe to Events and get a channel:")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('channelName := "testing_event_channel"\nerrCh := make(chan error)\neventsCh, err := client.SubscribeToEvents(ctx, channelName, "", errCh)\nif err != nil {\n \tlog.Fatal(err)\n}\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br")])]),t("p",[e._v("Then you can loop over the channel of events:")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('for {\n\tselect {\n\tcase err := <-errCh:\n\t\tlog.Fatal(err)\n\tcase event := <-eventsCh:\n\t\tlog.Printf("Event Received:\\nEventID: %s\\nChannel: %s\\nMetadata: %s\\nBody: %s\\n", event.Id, event.Channel, event.Metadata, event.Body)\n\t}\n}\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br")])]),t("h2",{attrs:{id:"events-store"}},[e._v("Events Store")]),e._v(" "),t("h3",{attrs:{id:"sending-events-store"}},[e._v("Sending Events Store")]),e._v(" "),t("h4",{attrs:{id:"single-event-to-store"}},[e._v("Single Event to Store")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('//sending 10 single events to store\nfor i := 0; i < 10; i++ {\n\tresult, err := client.ES().\n\t    SetId(fmt.Sprintf("event-store-%d", i)).\n\t\tSetChannel(channelName).\n\t\tSetMetadata("some-metadata").\n\t\tSetBody([]byte("hello kubemq - sending single event to store")).\n\t\tSend(ctx)\n\tif err != nil {\n\t\t\tlog.Fatal(err)\n\t}\n\tlog.Printf("Sending event #%d: Result: %t", i, result.Sent)\n}\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br"),t("span",{staticClass:"line-number"},[e._v("11")]),t("br"),t("span",{staticClass:"line-number"},[e._v("12")]),t("br"),t("span",{staticClass:"line-number"},[e._v("13")]),t("br")])]),t("h4",{attrs:{id:"stream-events-store"}},[e._v("Stream Events Store")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('// sending addtional events to store\neventsStoreStreamCh := make(chan *kubemq.EventStore, 1)\neventsStoreSResultCh := make(chan *kubemq.EventStoreResult, 1)\nerrStreamCh := make(chan error, 1)\ngo client.StreamEventsStore(ctx, eventsStoreStreamCh, eventsStoreSResultCh, errStreamCh)\nfor i := 0; i < 10; i++ {\n    event := client.ES().\n    SetId(fmt.Sprintf("event-store-%d", i)).\n    SetChannel(channelName).\n    SetMetadata("some-metadata").\n    SetBody([]byte("hello kubemq - sending stream event to store"))\n    eventsStoreStreamCh <- event\n    select {\n        case err := <-errStreamCh:\n    \t\tlog.Println(err)\n    \t\treturn\n   \t\tcase result := <-eventsStoreSResultCh:\n   \t\t\tlog.Printf("Sending event #%d: Result: %t", i, result.Sent)\n  \t\t}\n}\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br"),t("span",{staticClass:"line-number"},[e._v("11")]),t("br"),t("span",{staticClass:"line-number"},[e._v("12")]),t("br"),t("span",{staticClass:"line-number"},[e._v("13")]),t("br"),t("span",{staticClass:"line-number"},[e._v("14")]),t("br"),t("span",{staticClass:"line-number"},[e._v("15")]),t("br"),t("span",{staticClass:"line-number"},[e._v("16")]),t("br"),t("span",{staticClass:"line-number"},[e._v("17")]),t("br"),t("span",{staticClass:"line-number"},[e._v("18")]),t("br"),t("span",{staticClass:"line-number"},[e._v("19")]),t("br"),t("span",{staticClass:"line-number"},[e._v("20")]),t("br")])]),t("h3",{attrs:{id:"receiving-events-store"}},[e._v("Receiving Events Store")]),e._v(" "),t("p",[e._v("First you should subscribe to Events Store and get a channel:")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('eventsCh, err := client.SubscribeToEventsStore(ctx, channelName, "", errCh, kubemq.StartFromFirstEvent())\nif err != nil {\n \tlog.Fatal(err)\n }\n  \n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br")])]),t("h4",{attrs:{id:"subscription-options"}},[e._v("Subscription Options")]),e._v(" "),t("p",[e._v("KubeMQ supports 6 type of subscriptions:")]),e._v(" "),t("ul",[t("li",[e._v("StartFromNewEvents - start event store subscription with only new events")]),e._v(" "),t("li",[e._v("StartFromFirstEvent - replay all the stored events from the first available sequence and continue stream new events from this point")]),e._v(" "),t("li",[e._v("StartFromLastEvent - replay last event and continue stream new events from this point")]),e._v(" "),t("li",[e._v("StartFromSequence - replay events from specific event sequence number and continue stream new events from this point")]),e._v(" "),t("li",[e._v("StartFromTime - replay events from specific time continue stream new events from this point")]),e._v(" "),t("li",[e._v("StartFromTimeDelta - replay events from specific current time - delta duration in seconds, continue stream new events from this point")])]),e._v(" "),t("p",[e._v("Then you can loop over the channel of events:")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('for {\n\tselect {\n\tcase err := <-errCh:\n\t\tlog.Fatal(err)\n\tcase event := <-eventsCh:\n\t\tlog.Printf("Receive EventStore\\nSequence: %d\\nTime: %s\\nBody: %s\\n", event.Sequence, event.Timestamp, event.Body)\n\t}\n}\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br")])]),t("h2",{attrs:{id:"commands"}},[e._v("Commands")]),e._v(" "),t("h3",{attrs:{id:"concept"}},[e._v("Concept")]),e._v(" "),t("p",[e._v("Commands implements synchronous messaging pattern which the sender send a request and wait for specific amount of time to get a response.")]),e._v(" "),t("p",[e._v("The response can be successful or not. This is the responsibility of the responder to return with the result of the command within the time the sender set in the request.")]),e._v(" "),t("h3",{attrs:{id:"sending-command-requests"}},[e._v("Sending Command Requests")]),e._v(" "),t("p",[e._v("In this example, the responder should send his response withing one second, otherwise an error will be return as timout.")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('response, err := client.C().\n\tSetId("some-command-id").\n\tSetChannel(channelName).\n\tSetMetadata("some-metadata").\n\tSetBody([]byte("hello kubemq - sending command, please reply")).\n\tSetTimeout(time.Second).\n\tSend(ctx)\nif err != nil {\n\tlog.Fatal(err)\n}\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br")])]),t("h3",{attrs:{id:"receiving-commands-requests"}},[e._v("Receiving Commands Requests")]),e._v(" "),t("p",[e._v("First get a channel of commands:")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('errCh := make(chan error)\ncommandsCh, err := client.SubscribeToCommands(ctx, channelName, "", errCh)\nif err != nil {\n\t\tlog.Fatal(err)\n    }\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br")])]),t("p",[e._v("Then a loop over the channel will get the requests from the senders.")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('for {\n\tselect {\n\tcase err := <-errCh:\n\t\tlog.Fatal(err)\n        return\n\tcase command := <-commandsCh:\n\t\tlog.Printf("Command Received:\\nId %s\\nChannel: %s\\nMetadata: %s\\nBody: %s\\n", command.Id, command.Channel, command.Metadata, command.Body)\n\tcase <-ctx.Done():\n\t\treturn\n\t}\n}\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br"),t("span",{staticClass:"line-number"},[e._v("11")]),t("br")])]),t("h3",{attrs:{id:"sending-a-command-response"}},[e._v("Sending a Command Response")]),e._v(" "),t("p",[e._v("When sending response there are two important things to remember:")]),e._v(" "),t("ul",[t("li",[e._v("Set the relevant requestId which you response to")]),e._v(" "),t("li",[e._v("Set the ResponseTo string to the value of the request ResponseTo field")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("err := client.R().\n    SetRequestId(command.Id).\n\tSetResponseTo(command.ResponseTo).\n\tSetExecutedAt(time.Now()).\n\tSend(ctx)\nif err != nil {\n\tlog.Fatal(err)\n}\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br")])]),t("h2",{attrs:{id:"queries"}},[e._v("Queries")]),e._v(" "),t("h3",{attrs:{id:"concept-2"}},[e._v("Concept")]),e._v(" "),t("p",[e._v("Queries implements synchronous messaging pattern which the sender send a request and wait for specific amount of time to get a response.")]),e._v(" "),t("p",[e._v("The response must includes metadata or body together with indication of successful or not operation. This is the responsibility of the responder to return with the result of the query within the time the sender set in the request.")]),e._v(" "),t("h3",{attrs:{id:"sending-query-requests"}},[e._v("Sending Query Requests")]),e._v(" "),t("p",[e._v("In this example, the responder should send his response withing one second, otherwise an error will be return as timout.")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('response, err := client.Q().\n    SetId("some-query-id").\n    SetChannel(channel).\n\tSetMetadata("some-metadata").\n\tSetBody([]byte("hello kubemq - sending a query, please reply")).\n\tSetTimeout(time.Second).\n\tSend(ctx)\nif err != nil {\n\tlog.Fatal(err)\n}\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br")])]),t("h3",{attrs:{id:"receiving-query-requests"}},[e._v("Receiving Query Requests")]),e._v(" "),t("p",[e._v("First get a channel of queries:")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('errCh := make(chan error)\nqueriesCh, err := client.SubscribeToQueries(ctx, channelName, "", errCh)\nif err != nil {\n\tlog.Fatal(err)\n}\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br")])]),t("p",[e._v("Then a loop over the channel will get the requests from the senders.")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('for {\n\tselect {\n\tcase err := <-errCh:\n\t\tlog.Fatal(err)\n\t\treturn\n\tcase query := <-queriesCh:\n\t\tlog.Printf("Query Received:\\nId %s\\nChannel: %s\\nMetadata: %s\\nBody: %s\\n", query.Id, query.Channel, query.Metadata, query.Body)\n\tcase <-ctx.Done():\n\t\treturn\n   \t}\n}\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br"),t("span",{staticClass:"line-number"},[e._v("11")]),t("br")])]),t("h3",{attrs:{id:"sending-a-query-response"}},[e._v("Sending a Query Response")]),e._v(" "),t("p",[e._v("When sending response there are two important things to remember:")]),e._v(" "),t("ul",[t("li",[e._v("Set the relevant requestId which you response to")]),e._v(" "),t("li",[e._v("Set the ResponseTo string to the value of the request ResponseTo field")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('err := client.R().\n    SetRequestId(query.Id).\n  \tSetResponseTo(query.ResponseTo).\n  \tSetExecutedAt(time.Now()).\n  \tSetMetadata("this is a response").\n  \tSetBody([]byte("got your query, you are good to go")).\n  \tSend(ctx)\n  \t\nif err != nil {\n\tlog.Fatal(err)\n}\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br"),t("span",{staticClass:"line-number"},[e._v("11")]),t("br")])])])}],!1,null,null,null);a.options.__file="sdk-go.md";n.default=a.exports}}]);